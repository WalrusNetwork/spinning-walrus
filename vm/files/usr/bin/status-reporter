#!/bin/ash

exec 3>&1 4>&2
trap 'exec 2>&4 1>&3' 0 1 2 3
exec 1>/var/log/status-reporter.txt 2>&1

touch /tmp/status-reporter.pid

mc_status=$(/usr/bin/minecraft-checker)

while [[ "$mc_status" == "offline" ]]
do
    sleep 10s
    mc_status=$(/usr/bin/minecraft-checker)
    echo ${mc_status}
done

/usr/bin/curl \
  		-X POST \
  		-H "Content-Type: application/json" \
		-H "Authorization: token "${GRAPHQL_TOKEN}"" \
  		--data "\"query\": { mutation(serverReady(id: "$(curl http://169.254.169.254/v1/instanceid)")) }" \
  		https://new.walrus.gg

sleep infinity